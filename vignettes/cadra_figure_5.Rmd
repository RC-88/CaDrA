---
title: "Reproduce CaDrA Figures"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{Reproduce CaDrA Figures}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE, messages=FALSE, warnings=FALSE}
knitr::opts_chunk$set(message=FALSE, collapse = TRUE, comment="", fig.align="center")
library(Biobase)
devtools::load_all(".")
```

# CaDrA Query of BRCA YAP/TAZ Activity

Here, we reproduce the results of Figure 5 of [[Kartha et al., 2019]](https://www.frontiersin.org/articles/10.3389/fgene.2019.00121/full) (the section titled "_CaDrA Reveals Novel Drivers of Oncogenic YAP/TAZ Activity in Human Breast Cancer_").

## Load packages

```r
library(CaDrA)
library(Biobase)
```

## Load & Format Data Inputs

```{r load.data}

## Read in BRCA GISTIC+Mutation ESet object
data(BRCA_GISTIC_MUT_SIG)
eset_mut_scna <- BRCA_GISTIC_MUT_SIG

## Read in input score
data(TAZYAP_BRCA_ACTIVITY)
input_scores <- TAZYAP_BRCA_ACTIVITY

## Samples to keep based on the overlap between the two inputs
overlap <- intersect(names(input_scores), Biobase::sampleNames(eset_mut_scna))
eset_mut_scna <- eset_mut_scna[,overlap]
input_scores <- input_scores[overlap]

## Binarize ES to only have 0's and 1's
exprs(eset_mut_scna)[exprs(eset_mut_scna) > 1] <- 1.0

## Pre-filter ESet based on occurrence frequency
eset_mut_scna_flt <- CaDrA::prefilter_data(
  ES = eset_mut_scna,
  max.cutoff = 0.6,  # max event frequency (60%)
  min.cutoff = 0.03  # min event frequency (3%)
) 

```

## Run CaDrA

Here, we are evaluating the candidate search over top 'N' starting features and checking for overlapping resulting features from each case

```{r cadra}

topn_res <- CaDrA::candidate_search(
  ES = eset_mut_scna_flt,
  input_score = input_scores,
  method = "ks",               # Use Kolmogorow-Smirnow Scoring function 
  weights = NULL,              # If weights is provided, it will be used to perform a weighted-KS test
  alternative = "less",        # Use one-sided p-value
  metric = "pval",             # use the KS p-value to search for best feature
  search_method = "both",      # Apply both forward and backward search
  top_N = 7,                   # Evaluate top 7 starting points for the search
  max_size = 7,                # Maximum size that a meta-feature can extend to do for a given search
  do_plot = FALSE,             # We will plot it AFTER finding the best hits
  best_score_only = FALSE      # If best_score_only = FALSE, it will return meta-feature ESet, 
                               # its observed input scores and corresponding best score
)

```

## Visualize Best Results

```{r visualize.best}

## Fetch the meta-feature ESet corresponding to best scores over top N searches
topn_best_meta <- CaDrA::topn_best(topn_res)

# Visualize best meta-feature result
CaDrA::meta_plot(topn_best_list = topn_best_meta, input_score_label = "YAP/TAZ Activity")

```

## Summarize Top N Results

```{r summarize}

# Evaluate results across top N features you started from
CaDrA::topn_plot(topn_list = topn_res) 

```

## R Session Info
```{r RsessionInfo}
sessionInfo()
```

